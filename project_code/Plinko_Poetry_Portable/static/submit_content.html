<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Untitled Document</title>

<script type="text/javascript">
function submit_content(){
	var valid_content = true;
	var str = document.getElementById("content_Textarea").value;
	var words = str.split(" ");
	
	for (var i=0;i<words.length;i++){
		if ((words[i].length)>16){
			alert(words[i]+" is longer than 16 characters.");
			valid_content = false;
			break;	
		}
	}
	
	if (valid_content){
		var http = new XMLHttpRequest();
		var url = "submit";
		var params = "content="+str;
		http.open("GET", url+"?"+params, true);
		http.onreadystatechange = function() {//Call a function when the state changes.
			if(http.readyState == 4 && http.status == 200) {
				if (http.responseText.indexOf("OK")>=0){
					alert("Your content has been added");
				}else{
					alert(http.responseText);
				}
			}
		}
		http.send(null);
	}
}

function get_poems(){
	var http = new XMLHttpRequest();
	var url = "recent_poems";
	http.open("GET", url, true);
	http.onreadystatechange = function() {//Call a function when the state changes.
		if(http.readyState == 4 && http.status == 200) {
			var poems = http.responseText.trim().split("\n");
			var html_buf="";
			for (var i=0;i<poems.length;i++){
				var elements = poems[i].split("\t");
				var style_str = "";
				if (elements[0]=="GOOD"){
					style_str = "style=\"color:#80FF80;\"";
				}else if (elements[0]=="BAD"){
					style_str = "style=\"color:#FF8080;\"";
				}
				html_buf=html_buf+"<div "+style_str+">"+elements[1]+"</div>\n";
			}
			document.getElementById("poems").innerHTML=html_buf;			
		}
	}
	http.send(null);
}

</script>

</head>

<body>
<p>Recent poems:</p>

<div id="poems"></div>
<script type="text/javascript">
	get_poems();
</script>

<p>&nbsp;</p>

<p>You can also submit new contents for poems.</p>
<p>Please input between 60~200 characters</p>
<div><textarea id="content_Textarea" name="content" rows="10" cols="60"></textarea></div>
<button type="button" onclick="submit_content()">submit some new content</button>
<p><a href=".">back</a></p>

</body>
</html>
